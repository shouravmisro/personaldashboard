<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Personal Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">

  <div class="container py-4">
    <h1 class="mb-4">Personal Dashboard</h1>

    <!-- Location and Weather Section -->
    <div class="mb-4">
      <h3>Weather & Habit Suggestions</h3>
      <div class="row align-items-end mb-3">
        <div class="col-md-6">
          <input type="text" id="location" class="form-control" placeholder="Enter Location" value="Dhaka" />
        </div>
        <div class="col-md-3">
          <button id="fetchWeatherBtn" class="btn btn-primary">Get Weather & Suggestions</button>
        </div>
      </div>
      <div id="weatherSection" class="mb-3"></div>
      <div id="habitsSuggestionsSection" class="mb-5"></div>
    </div>

    <hr/>

    <!-- Events Section -->
    <div class="mb-5">
      <h3>Events</h3>
      <ul id="eventsList" class="list-group"></ul>
    </div>

    <hr/>

    <!-- Tasks Section -->
    <div class="mb-5">
      <h3>To-Do Tasks</h3>
      <ul id="tasksList" class="list-group"></ul>
    </div>

    <hr/>

    <!-- Habits Section -->
    <div class="mb-5">
      <h3>Habits</h3>
      <ul id="habitsList" class="list-group"></ul>
    </div>

  </div>

  <script>
    // Utility to create list items
    function createListItem(text) {
      const li = document.createElement('li');
      li.classList.add('list-group-item');
      li.textContent = text;
      return li;
    }

    // Fetch and display weather & habit suggestions
    document.getElementById('fetchWeatherBtn').onclick = function () {
      const loc = document.getElementById('location').value.trim();
      if (!loc) {
        alert('Please enter a location');
        return;
      }
      fetch(`/weather-habits?location=${encodeURIComponent(loc)}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            document.getElementById('weatherSection').innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
            document.getElementById('habitsSuggestionsSection').innerHTML = '';
            return;
          }
          const weather = data.weather;
          const suggestions = data.habit_suggestions;

          document.getElementById('weatherSection').innerHTML = `
            <p><strong>Temperature:</strong> ${weather.main.temp}Â°C</p>
            <p><strong>Condition:</strong> ${weather.weather[0].description}</p>
          `;

          if (suggestions.length) {
            const ul = document.createElement('ul');
            ul.classList.add('list-group');
            suggestions.forEach(sugg => ul.appendChild(createListItem(sugg)));
            const container = document.getElementById('habitsSuggestionsSection');
            container.innerHTML = '<h5>Habit Suggestions:</h5>';
            container.appendChild(ul);
          } else {
            document.getElementById('habitsSuggestionsSection').innerHTML = '';
          }
        });
    };

    // Fetch and display Events
    function loadEvents() {
      fetch('/events')
        .then(res => res.json())
        .then(events => {
          const container = document.getElementById('eventsList');
          container.innerHTML = '';
          events.forEach(e => {
            container.appendChild(createListItem(`${e.title} - ${e.event_date}`));
          });
        });
    }

    // Fetch and display Tasks
    function loadTasks() {
      fetch('/tasks')
        .then(res => res.json())
        .then(tasks => {
          const container = document.getElementById('tasksList');
          container.innerHTML = '';
          tasks.forEach(t => {
            container.appendChild(createListItem(`${t.task_text} [${t.completed ? 'Done' : 'Pending'}]`));
          });
        });
    }

    // Fetch and display Habits
    function loadHabits() {
      fetch('/habits')
        .then(res => res.json())
        .then(habits => {
          const container = document.getElementById('habitsList');
          container.innerHTML = '';
          habits.forEach(h => {
            container.appendChild(createListItem(`${h.habit_name} - Progress: ${h.progress}/${h.goal}`));
          });
        });
    }

    // Load all data on page load
    window.onload = function () {
      loadEvents();
      loadTasks();
      loadHabits();
      document.getElementById('fetchWeatherBtn').click(); // Load weather & suggestions for default location
    };
  </script>

</body>
</html>
